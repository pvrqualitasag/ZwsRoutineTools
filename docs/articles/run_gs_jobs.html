<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>How To Run GS-Jobs â€¢ zwsroutinetools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="How To Run GS-Jobs">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">zwsroutinetools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/zwsroutinetools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/compare_plots.html">Compare Plots</a>
    </li>
    <li>
      <a href="../articles/create_comparison_plot_report.html">Comparison Plot Reports</a>
    </li>
    <li>
      <a href="../articles/extract_characteristics_from_logfiles.html">Extract Characteristic Numbers From Logfiles</a>
    </li>
    <li>
      <a href="../articles/lbe_qs_description.html">QA Based On LBE GE Guide</a>
    </li>
    <li>
      <a href="../articles/literate_bash_programming.html">Literate Bash Programming</a>
    </li>
    <li>
      <a href="../articles/run_gs_jobs.html">How To Run GS-Jobs</a>
    </li>
    <li>
      <a href="../articles/runtime_from_log.html">Script Run-Times Based Logfiles</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>How To Run GS-Jobs</h1>
                        <h4 class="author">Peter von Rohr</h4>
            
            <h4 class="date">2019-07-29</h4>
      
      
      <div class="hidden name"><code>run_gs_jobs.Rmd</code></div>

    </div>

    
    
<p>GS-Jobs are used to estimate SNP-effects in genomic breeding value estimation. For different breeds (rh, si, sf, bv, ob), different traits, different input data (full and reduced) and different estimation quantities (eff or rel) combinations are formed and jobs are defined. In total there are about 1000 different job definitions.</p>
<div id="prerequisites" class="section level2">
<h2 class="hasAnchor">
<a href="#prerequisites" class="anchor"></a>Prerequisites</h2>
<p>To be able to start the GS-jobs, conventional prediction of breeding values must be finished.</p>
</div>
<div id="constraints" class="section level2">
<h2 class="hasAnchor">
<a href="#constraints" class="anchor"></a>Constraints</h2>
<p>There is a deadline for when results of GS-jobs must be ready. To meet the deadline it is important to start the GS-jobs on the planed date which is a Friday. When starting the GS-jobs on a Friday gives a weekend to run the jobs. The total time of about 11 days should be enough for the GS-jobs in the ideal case. But this ideal case can only be realized if certain conditions are met. The conditions are mostly related to the very different performance of the different machines and the very different runtimes for the different GS-jobs. Here it is important to follow the rule that the jobs with the largest runtimes are run on the fastest computers, otherwise, the computation time is too high. The problem here is that it is not easy to determine the total computing time for each job. There are some informations in the logfiles, but they are dependent on the computer on which they run.</p>
<p><img src="odg/jobtomachinemapping.png" width="640"></p>
<p>From a technical point of view, it is important to limit the number of jobs that are simultaneously running on any given machine by two parameters.</p>
<ol style="list-style-type: decimal">
<li>the number of cores that are available on a given machine. There is not point in submitting more jobs that we have cores, because otherwise a certain amount of the performance must be invested in context switching between the jobs. Our computers typically have something between 32 and 40 cores.</li>
<li>the amount of RAM available on each machine. With the larger SNP chips (150K instead of 50K) the memory requirement of each job increased substantially. Some jobs might use up until 10G. Based on some observations, it is likely that the amount of memory required for each job is highest at the beginning of the job. Therefore, we should not start very many jobs at the same time, because we do not want to use up all memory at the beginning of the runtime of the GS-jobs. It must be avoided that all physical RAM is exhausted because, if that happens the machine starts to swap. Swapping means that some parts of the data in RAM which are not needed are written to the swap disk. Whenever the data on the swap disk is needed again, it is transfered back into RAM. This process of swapping slows down any computation by about a factor of 1000. As a rule of thumb, if a machine starts to swap, we have to kill as many jobs as it takes that all data from the running jobs fit into RAM.</li>
</ol>
</div>
<div id="goal" class="section level2">
<h2 class="hasAnchor">
<a href="#goal" class="anchor"></a>Goal</h2>
<p>The goal is to let the GS-jobs running with as little interaction as possible. That means, at the beginning, we assign each server a number of jobs and they run without any intervention.</p>
</div>
<div id="implementation-ideas" class="section level2">
<h2 class="hasAnchor">
<a href="#implementation-ideas" class="anchor"></a>Implementation Ideas</h2>
<p>A first idea is to split the complete list of all jobs into smaller batches of jobs. The size of the batches should be smaller than the number of cores on each of the machines.</p>
</div>
<div id="design-ideas-for-a-pipeline" class="section level2">
<h2 class="hasAnchor">
<a href="#design-ideas-for-a-pipeline" class="anchor"></a>Design Ideas For A Pipeline</h2>
<p>The computation of estimated genomic breeding values is done with a number of steps. By putting the single step in a sequence, the result is a pipeline that works on job-definition files. The job-definition files contain path information about the single compute jobs that must be run by the pipeline.</p>
<p>The current steps of the pipeline operate in a fashion that they ignore any job which does not fullfill the prerequisites of the current step. Futhermore, any existing result files from a previous run of the same step are either first deleted in the case of <code>runBayesC.sh</code> or are overwritten in the case of the prediction scripts. This requires that one step can only be performed whenever the previous step is already finished. This increases the overall runtime of the whole pipeline.</p>
<p>An Alternative idea might be to produce checker-scripts that can be run after each step which find the jobs that have not completed a given prerequisites. These jobs are then written to new job-definition files which can be used in a second call to the same pipeline step.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#prerequisites">Prerequisites</a></li>
      <li><a href="#constraints">Constraints</a></li>
      <li><a href="#goal">Goal</a></li>
      <li><a href="#implementation-ideas">Implementation Ideas</a></li>
      <li><a href="#design-ideas-for-a-pipeline">Design Ideas For A Pipeline</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Peter von Rohr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
