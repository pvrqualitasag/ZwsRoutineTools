<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>QA Based On LBE GE Guide • zwsroutinetools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="QA Based On LBE GE Guide">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">zwsroutinetools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/zwsroutinetools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/compare_plots.html">Compare Plots</a>
    </li>
    <li>
      <a href="../articles/create_comparison_plot_report.html">Comparison Plot Reports</a>
    </li>
    <li>
      <a href="../articles/extract_characteristics_from_logfiles.html">Extract Characteristic Numbers From Logfiles</a>
    </li>
    <li>
      <a href="../articles/lbe_qs_description.html">QA Based On LBE GE Guide</a>
    </li>
    <li>
      <a href="../articles/literate_bash_programming.html">Literate Bash Programming</a>
    </li>
    <li>
      <a href="../articles/run_gs_jobs.html">How To Run GS-Jobs</a>
    </li>
    <li>
      <a href="../articles/runtime_from_log.html">Script Run-Times Based Logfiles</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>QA Based On LBE GE Guide</h1>
                        <h4 class="author">Peter von Rohr</h4>
            
            <h4 class="date">2019-07-29</h4>
      
      
      <div class="hidden name"><code>lbe_qs_description.Rmd</code></div>

    </div>

    
    
<div id="qa-requirements-taken-from-the-ge-recipe" class="section level2">
<h2 class="hasAnchor">
<a href="#qa-requirements-taken-from-the-ge-recipe" class="anchor"></a>QA Requirements Taken From the GE-Recipe</h2>
<p>The following list of points is taken from <a href="https://qualitasag.atlassian.net/wiki/spaces/ZWS/pages/250314857/Anleitung+ZWS+LBE+bv+je+und+rh#AnleitungZWSLBEbv,jeundrh-LBE_Qualitaetssicherung" class="uri">https://qualitasag.atlassian.net/wiki/spaces/ZWS/pages/250314857/Anleitung+ZWS+LBE+bv+je+und+rh#AnleitungZWSLBEbv,jeundrh-LBE_Qualitaetssicherung</a> and it describes the logfiles that need to be taken into account for QA.</p>
<ol style="list-style-type: decimal">
<li>Nach ca. 1 Stunde nach dem Start von EVAL_DIR/prog/chef.sh verschiedene Outputs und Log-Dateien prüfen und mit den entsprechenden Dateien aus der vorhergehenden Auswertung vergleichen. Diese Dateien sind in <code>EVAL_DIR/data/${Zuchtorganisation}</code> und heissen:
<ul>
<li>mehrfacheLBEs.txt: Duplikate der ZO melden</li>
<li>checkSchema.log: Hier ist insbesondere ist darauf zu achten, dass es bei allen Schema, bei denen es Datenzuwachs geben sollte, diesen auch tatsächlich im üblichen Masse gibt.</li>
<li>abgelehnteLBEsWegenCheckSchema.csv: Falls es eine grosse Zunahme an Einträgen in dieser Datei gibt, weist das auf ein neues Schema oder auf Fehler/Ungenauigkeiten in den Dateien mit Schemaspezifikationen hin.</li>
<li>selectAnimalsOfBreed_*.log</li>
<li>wurstleDatenZurecht_*_*.log</li>
<li>plausiLBE_*.log</li>
<li>fehlerhafteLBEs_*.txt</li>
<li>macheBeobPositiv.log</li>
</ul>
</li>
<li>Nur bei Basisanpassung: Kontrollieren ob die Basistiere richtig eingestellt (vor allem bezüglich Geburtsjahrgänge) sind.</li>
<li>Vergleichsgrafiken und -Tabellen analysieren.</li>
<li>In der Datei /qualstorzws01/data_zws/zwKontrolle/ZuwachsDatenZWS_BV_JE_RH.xls die Anzahl Records der Input- und Output-Dateien eintragen sowie Differenzen zur vorhergehenden ZWS rechnen.</li>
</ol>
</div>
<div id="tool-development" class="section level2">
<h2 class="hasAnchor">
<a href="#tool-development" class="anchor"></a>Tool Development</h2>
<div id="number-of-duplicate-lbe-records" class="section level3">
<h3 class="hasAnchor">
<a href="#number-of-duplicate-lbe-records" class="anchor"></a>Number of duplicate LBE records</h3>
<p>The first thing that we have to check are the number of duplicates. The number of duplicate information corresponds to the number of lines in the file <code>mehrfacheLBEs.txt</code>. The number of lines in the file can be determined by using the <code>wc -l</code> command on the shell. For a given duplicate logfile the number of lines can be determined by</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">s_dup_lf &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata/lbe-logs/mehrfacheLBEs.txt"</span>, <span class="dt">package =</span> <span class="st">'zwsroutinetools'</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">s_nr_dupl &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system">system</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste0</a></span>(<span class="st">'wc -l '</span>, s_dup_lf), <span class="dt">intern =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">s_nr_dupl&lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="dt">pattern =</span> <span class="st">'^</span><span class="ch">\\</span><span class="st">s{1,}'</span>, <span class="dt">replacement =</span> <span class="st">''</span>, s_nr_dupl)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">n_nr_dupl &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(s_nr_dupl, <span class="dt">split =</span> <span class="st">'</span><span class="ch">\\</span><span class="st">s{1,}'</span>))[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"The number of duplicate LBEs is: "</span>, n_nr_dupl, <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt; The number of duplicate LBEs is:  0</span></a></code></pre></div>
<p>This is converted into the following function</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">get_nr_line_file &lt;-<span class="st"> </span><span class="cf">function</span>(ps_file_path){</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">  <span class="co"># check whether the file exists</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="cf">if</span> (<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/files">file.exists</a></span>(ps_file_path)) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/stop">stop</a></span>(<span class="st">"ERROR: Cannot find file: "</span>, ps_file_path)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="co"># do the line counting with wc -l</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  s_nr_dupl &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system">system</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/paste">paste</a></span>(<span class="st">'wc -l'</span>, ps_file_path), <span class="dt">intern =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="co"># replace leading spaces from result</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">  s_nr_dupl&lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">gsub</a></span>(<span class="dt">pattern =</span> <span class="st">'^</span><span class="ch">\\</span><span class="st">s{1,}'</span>, <span class="dt">replacement =</span> <span class="st">''</span>, s_nr_dupl)</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">  <span class="co"># return the number of lines corresponding to the first element of the result as a number</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/numeric">as.numeric</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(s_nr_dupl, <span class="dt">split =</span> <span class="st">'</span><span class="ch">\\</span><span class="st">s{1,}'</span>))[<span class="dv">1</span>]))</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">}</a></code></pre></div>
<p>The test with the above used file is done as</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/cat">cat</a></span>(<span class="st">"The number of duplicate LBEs is: "</span>, <span class="kw">get_nr_line_file</span>(<span class="dt">ps_file_path =</span> s_dup_lf), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt; The number of duplicate LBEs is:  0</span></a></code></pre></div>
</div>
<div id="data-increments-over-schemas" class="section level3">
<h3 class="hasAnchor">
<a href="#data-increments-over-schemas" class="anchor"></a>Data Increments over Schemas</h3>
<p>The logfile <code>checkSchema.log</code> contains information about the distribution of the data records accross the different recording schemas. To extract the information on the number of records per recording scheme, we have to read the logfile and parse it to find the relevant information.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">s_check_log_path &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/system.file">system.file</a></span>(<span class="st">"extdata/lbe-logs/checkSchema.log"</span>, <span class="dt">package =</span> <span class="st">'zwsroutinetools'</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">con_log &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">file</a></span>(<span class="dt">description =</span> s_check_log_path)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">vec_log &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(<span class="dt">con =</span> con_log)</a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">close</a></span>(<span class="dt">con =</span> con_log)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="co"># remove empty lines from log file</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">vec_idx_empty_lines &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grep</a></span>(<span class="dt">pattern =</span> <span class="st">'^$'</span>, vec_log)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">vec_log &lt;-<span class="st"> </span>vec_log[<span class="op">-</span>vec_idx_empty_lines]</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="co"># search for lines containing information about number of records per schema</span></a>
<a class="sourceLine" id="cb4-9" data-line-number="9">vec_idx_schema_info &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grep</a></span>(<span class="dt">pattern =</span> <span class="st">'^</span><span class="ch">\\</span><span class="st">s{1,}Anzahl LBEs aus'</span>, vec_log)</a>
<a class="sourceLine" id="cb4-10" data-line-number="10">vec_schema_info &lt;-<span class="st"> </span>vec_log[vec_idx_schema_info]</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">get_schema_stat &lt;-<span class="st"> </span><span class="cf">function</span>(ps_line){</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">  vec_line_cont &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(ps_line, <span class="dt">split =</span> <span class="st">'</span><span class="ch">\\</span><span class="st">s{1,}'</span>))</a>
<a class="sourceLine" id="cb4-13" data-line-number="13">  n_schema_name_idx &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grep</a></span>(<span class="dt">pattern =</span> <span class="st">"Schema"</span>, vec_line_cont, <span class="dt">fixed =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(<span class="dt">schema =</span> vec_line_cont[n_schema_name_idx], </a>
<a class="sourceLine" id="cb4-15" data-line-number="15">                        <span class="dt">nrecords =</span> vec_line_cont[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(vec_line_cont)]))</a>
<a class="sourceLine" id="cb4-16" data-line-number="16">}</a></code></pre></div>
<p>The above extraction function can be tested for a single line as</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">get_schema_stat</span>(vec_schema_info[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#&gt; # A tibble: 1 x 2</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt;   schema             nrecords</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt;   &lt;chr&gt;              &lt;chr&gt;   </span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; 1 BVCH_1992_mitEinst 6054</span></a></code></pre></div>
<p>As the result seams to be ok, we are applying the function to all schema records using the <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map</a></code> function. Finally, we are re-grouping the result into a single <code>tibble</code>.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">l_result &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(vec_schema_info, get_schema_stat)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">tbl_result &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(l_result)){</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  tbl_result &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(tbl_result, l_result[[i]])</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">}</a></code></pre></div>
<p>Re-formating the result tibble into a table leads to</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(tbl_result, <span class="dt">booktabs =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">schema</th>
<th align="left">nrecords</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">BVCH_1992_mitEinst</td>
<td align="left">6054</td>
</tr>
<tr class="even">
<td align="left">BVCH_1992_ohneEinst</td>
<td align="left">8012</td>
</tr>
<tr class="odd">
<td align="left">BVCH_1994_mitEinst</td>
<td align="left">20525</td>
</tr>
<tr class="even">
<td align="left">BVCH_1994_ohneEinst</td>
<td align="left">6241</td>
</tr>
<tr class="odd">
<td align="left">BVCH_1996</td>
<td align="left">366989</td>
</tr>
<tr class="even">
<td align="left">BVCH_2003</td>
<td align="left">234165</td>
</tr>
<tr class="odd">
<td align="left">BVCH_2008_ohneBem</td>
<td align="left">249</td>
</tr>
<tr class="even">
<td align="left">BVCH_2008</td>
<td align="left">134195</td>
</tr>
<tr class="odd">
<td align="left">BVCH_2011_ohneBem</td>
<td align="left">143</td>
</tr>
<tr class="even">
<td align="left">BVCH_2011</td>
<td align="left">260505</td>
</tr>
<tr class="odd">
<td align="left">BVCH_2018</td>
<td align="left">33342</td>
</tr>
<tr class="even">
<td align="left">HW_1</td>
<td align="left">517</td>
</tr>
<tr class="odd">
<td align="left">HW_2</td>
<td align="left">234</td>
</tr>
<tr class="even">
<td align="left">HW_3</td>
<td align="left">144</td>
</tr>
<tr class="odd">
<td align="left">RGS_2016</td>
<td align="left">619</td>
</tr>
</tbody>
</table>
<p>The complete functionality of extracting the number of records from a logfile is enclosed in a separate function.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co">#' Get Schema Statistics from Logfile</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">get_schema_stat_from_log &lt;-<span class="st"> </span><span class="cf">function</span>(ps_check_log_path, </a>
<a class="sourceLine" id="cb8-3" data-line-number="3">                                     <span class="dt">ps_schema_line_pat =</span> <span class="st">'^</span><span class="ch">\\</span><span class="st">s{1,}Anzahl LBEs aus'</span>,</a>
<a class="sourceLine" id="cb8-4" data-line-number="4">                                     <span class="dt">ps_schema_num_pat  =</span> <span class="st">'Schema'</span>){</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">  <span class="co">#' Helper function to extract tibble with schema name and number of </span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6">  <span class="co">#'  records for corresponding schema</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">  get_schema_stat &lt;-<span class="st"> </span><span class="cf">function</span>(ps_line, ps_schema_num_pat){</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">   vec_line_cont &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unlist">unlist</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/strsplit">strsplit</a></span>(ps_line, <span class="dt">split =</span> <span class="st">'</span><span class="ch">\\</span><span class="st">s{1,}'</span>))</a>
<a class="sourceLine" id="cb8-9" data-line-number="9">    n_schema_name_idx &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grep</a></span>(<span class="dt">pattern =</span> ps_schema_num_pat, vec_line_cont, <span class="dt">fixed =</span> <span class="ot">TRUE</span>) <span class="op">+</span><span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10">    <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(tibble<span class="op">::</span><span class="kw"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span>(<span class="dt">schema =</span> vec_line_cont[n_schema_name_idx], </a>
<a class="sourceLine" id="cb8-11" data-line-number="11">                          <span class="dt">nrecords =</span> vec_line_cont[<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(vec_line_cont)]))</a>
<a class="sourceLine" id="cb8-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb8-13" data-line-number="13">  <span class="co"># Read the log file into a vector of characters</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14">  con_log &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">file</a></span>(<span class="dt">description =</span> ps_check_log_path)</a>
<a class="sourceLine" id="cb8-15" data-line-number="15">  vec_log &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readLines">readLines</a></span>(<span class="dt">con =</span> con_log)</a>
<a class="sourceLine" id="cb8-16" data-line-number="16">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/connections">close</a></span>(<span class="dt">con =</span> con_log)</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">  <span class="co"># remove empty lines from log file</span></a>
<a class="sourceLine" id="cb8-18" data-line-number="18">  vec_idx_empty_lines &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grep</a></span>(<span class="dt">pattern =</span> <span class="st">'^$'</span>, vec_log)</a>
<a class="sourceLine" id="cb8-19" data-line-number="19">  vec_log &lt;-<span class="st"> </span>vec_log[<span class="op">-</span>vec_idx_empty_lines]</a>
<a class="sourceLine" id="cb8-20" data-line-number="20">  <span class="co"># search for lines containing information about number of records per schema</span></a>
<a class="sourceLine" id="cb8-21" data-line-number="21">  vec_idx_schema_info &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/grep">grep</a></span>(<span class="dt">pattern =</span> ps_schema_line_pat, vec_log)</a>
<a class="sourceLine" id="cb8-22" data-line-number="22">  vec_schema_info &lt;-<span class="st"> </span>vec_log[vec_idx_schema_info]</a>
<a class="sourceLine" id="cb8-23" data-line-number="23">  <span class="co"># run the extractor function get_schema_stat for each line of vec_schema_info</span></a>
<a class="sourceLine" id="cb8-24" data-line-number="24">  l_result &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw"><a href="https://purrr.tidyverse.org/reference/map.html">map</a></span>(vec_schema_info, get_schema_stat, ps_schema_num_pat)</a>
<a class="sourceLine" id="cb8-25" data-line-number="25">  <span class="co"># aggregate list of results into single tibble</span></a>
<a class="sourceLine" id="cb8-26" data-line-number="26">  tbl_result &lt;-<span class="st"> </span><span class="ot">NULL</span></a>
<a class="sourceLine" id="cb8-27" data-line-number="27">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/seq">seq_along</a></span>(l_result)){</a>
<a class="sourceLine" id="cb8-28" data-line-number="28">    tbl_result &lt;-<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span>(tbl_result, l_result[[i]])</a>
<a class="sourceLine" id="cb8-29" data-line-number="29">  }</a>
<a class="sourceLine" id="cb8-30" data-line-number="30">  <span class="co"># return result</span></a>
<a class="sourceLine" id="cb8-31" data-line-number="31">  <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/function">return</a></span>(tbl_result)</a>
<a class="sourceLine" id="cb8-32" data-line-number="32">}</a></code></pre></div>
<p>Testing the created function leads to</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">tbl_schema_rec_result &lt;-<span class="st"> </span><span class="kw">get_schema_stat_from_log</span>(<span class="dt">ps_check_log_path =</span> s_check_log_path)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>(tbl_schema_rec_result, <span class="dt">booktabs =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">schema</th>
<th align="left">nrecords</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">BVCH_1992_mitEinst</td>
<td align="left">6054</td>
</tr>
<tr class="even">
<td align="left">BVCH_1992_ohneEinst</td>
<td align="left">8012</td>
</tr>
<tr class="odd">
<td align="left">BVCH_1994_mitEinst</td>
<td align="left">20525</td>
</tr>
<tr class="even">
<td align="left">BVCH_1994_ohneEinst</td>
<td align="left">6241</td>
</tr>
<tr class="odd">
<td align="left">BVCH_1996</td>
<td align="left">366989</td>
</tr>
<tr class="even">
<td align="left">BVCH_2003</td>
<td align="left">234165</td>
</tr>
<tr class="odd">
<td align="left">BVCH_2008_ohneBem</td>
<td align="left">249</td>
</tr>
<tr class="even">
<td align="left">BVCH_2008</td>
<td align="left">134195</td>
</tr>
<tr class="odd">
<td align="left">BVCH_2011_ohneBem</td>
<td align="left">143</td>
</tr>
<tr class="even">
<td align="left">BVCH_2011</td>
<td align="left">260505</td>
</tr>
<tr class="odd">
<td align="left">BVCH_2018</td>
<td align="left">33342</td>
</tr>
<tr class="even">
<td align="left">HW_1</td>
<td align="left">517</td>
</tr>
<tr class="odd">
<td align="left">HW_2</td>
<td align="left">234</td>
</tr>
<tr class="even">
<td align="left">HW_3</td>
<td align="left">144</td>
</tr>
<tr class="odd">
<td align="left">RGS_2016</td>
<td align="left">619</td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#qa-requirements-taken-from-the-ge-recipe">QA Requirements Taken From the GE-Recipe</a></li>
      <li><a href="#tool-development">Tool Development</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Peter von Rohr.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
